{
  "phase": "Phase 5 - Final Testing & Documentation",
  "description": "End-to-end role-based access control testing and comprehensive documentation",
  "priority": "CRITICAL",
  "estimatedTime": "2-3 hours",
  "dependencies": ["Phase 1", "Phase 2", "Phase 3", "Phase 4"],

  "ASANMOD_STRICT_MODE": {
    "FORBIDDEN": [
      "‚ùå NO simulation or mocking - use REAL tools only",
      "‚ùå NO placeholder outputs - paste REAL terminal data",
      "‚ùå NO 'all tests passed' without proof",
      "‚ùå NO assumptions - verify everything with real commands",
      "‚ùå NO fake browser test results - human must test",
      "‚ùå NO skipping verification commands"
    ],
    "REQUIRED": [
      "‚úÖ ALWAYS use Bash tool for verification commands",
      "‚úÖ ALWAYS use Read tool before Edit tool",
      "‚úÖ ALWAYS paste exact terminal outputs to reports",
      "‚úÖ ALWAYS run real docker logs checks",
      "‚úÖ ALWAYS verify file exists before claiming done",
      "‚úÖ ALWAYS let reviewer decide if task completed",
      "‚úÖ ALWAYS check console logs for errors"
    ],
    "VERIFICATION_PRINCIPLE": "Ham veri konu≈üur - AI cannot lie with real grep/wc/curl outputs!"
  },

  "mcpRequirements": {
    "required": ["Read", "Write", "Bash", "Grep"],
    "optional": ["Edit"],
    "usage": "Read phase JSONs, run verification commands, create test reports with RAW outputs"
  },

  "tasks": [
    {
      "id": "5.1",
      "title": "Cross-Phase Verification",
      "priority": "CRITICAL",
      "estimatedTime": "30 minutes",
      "description": "Verify all phases completed successfully with real data",
      "outputFile": "docs/reports/phase5-cross-verification.md",
      "instructions": [
        "‚ö†Ô∏è ASANMOD STRICT MODE - REAL VERIFICATION ONLY ‚ö†Ô∏è",
        "1. Read all phase verification reports (P1, P2, P3, P4)",
        "2. Re-run key verification commands from each phase",
        "3. Count protected routes, pages, menu items",
        "4. Verify all numbers match expected totals",
        "5. Paste ALL outputs to MD file",
        "6. DO NOT interpret - raw data only",
        "‚ùå FORBIDDEN: Assuming phases complete without re-checking",
        "‚úÖ REQUIRED: Re-run verification commands, paste real outputs"
      ],
      "verificationCommands": {
        "p1_infrastructure": "ls -la /home/asan/Desktop/ikai/backend/src/middleware/authorize.js /home/asan/Desktop/ikai/frontend/lib/hoc/withRoleProtection.tsx",
        "p2_backend_routes": "grep -r 'authorize(' /home/asan/Desktop/ikai/backend/src/routes --include='*.js' | wc -l",
        "p3_frontend_pages": "grep -r 'withRoleProtection' /home/asan/Desktop/ikai/frontend/app/\\(authenticated\\) --include='page.tsx' | wc -l",
        "p4_sidebar_menus": "grep -n 'useHasRole\\|isAdmin\\|isSuperAdmin' /home/asan/Desktop/ikai/frontend/components/AppLayout.tsx | wc -l"
      },
      "reportTemplate": "# Phase 5 - Cross-Phase Verification\n\n**‚ö†Ô∏è MOD VERIFICATION REQUIRED:**\nMod MUST re-run ALL commands to verify Worker's outputs.\n\n---\n\nDate: [CURRENT_DATE]\nExecutor: [WORKER_NAME]\n\n## 1. Phase 1 Infrastructure Check\n\n```bash\n$ ls -la backend/src/middleware/authorize.js frontend/lib/hoc/withRoleProtection.tsx\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** Both files exist with recent modification dates\n\n---\n\n## 2. Phase 2 Backend Routes Count\n\n```bash\n$ grep -r 'authorize(' backend/src/routes --include='*.js' | wc -l\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** 26 protected routes\n\n---\n\n## 3. Phase 3 Frontend Pages Count\n\n```bash\n$ grep -r 'withRoleProtection' frontend/app/(authenticated) --include='page.tsx' | wc -l\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** 32 lines (16 files √ó 2 lines each)\n\n---\n\n## 4. Phase 4 Sidebar Hooks Count\n\n```bash\n$ grep -n 'useHasRole\\|isAdmin\\|isSuperAdmin' frontend/components/AppLayout.tsx | wc -l\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** Multiple lines showing role checks\n\n---\n\n## Summary\n\n**Phase 1:** [COMPLETE/INCOMPLETE]\n**Phase 2:** [COMPLETE/INCOMPLETE]\n**Phase 3:** [COMPLETE/INCOMPLETE]\n**Phase 4:** [COMPLETE/INCOMPLETE]\n\n**Overall Status:** [ALL_PHASES_COMPLETE / SOME_INCOMPLETE]\n\n---\n\n**Note to Mod:** Re-run all commands to verify Worker used real tools.\n"
    },
    {
      "id": "5.2",
      "title": "End-to-End Role Testing Matrix",
      "priority": "CRITICAL",
      "estimatedTime": "60 minutes",
      "description": "Test all 5 roles across backend routes, frontend pages, and sidebar menus",
      "outputFile": "docs/reports/phase5-e2e-testing.md",
      "instructions": [
        "‚ö†Ô∏è ASANMOD STRICT MODE - HUMAN TESTING REQUIRED ‚ö†Ô∏è",
        "‚ùå AI CANNOT simulate E2E testing - HUMAN MUST DO THIS",
        "1. HUMAN logs in as each role (USER, HR_SPECIALIST, MANAGER, ADMIN, SUPER_ADMIN)",
        "2. HUMAN tests 3 backend routes per role (using curl or Postman)",
        "3. HUMAN tests 3 frontend pages per role (browser navigation)",
        "4. HUMAN verifies sidebar menu visibility",
        "5. AI creates report template for HUMAN to fill",
        "6. HUMAN pastes real outputs, screenshots optional",
        "‚ö†Ô∏è This task REQUIRES human interaction"
      ],
      "reportTemplate": "# Phase 5 - End-to-End Role Testing Matrix\n\nDate: [CURRENT_DATE]\nTester: [YOUR_NAME]\n\n---\n\n## Test 1: USER Role\n\n**Test Account:** user@test.com\n\n### Backend API Tests\n\n**Test 1.1: Try to access HR route**\n```bash\n$ curl -H \"Authorization: Bearer [USER_TOKEN]\" http://localhost:8102/api/v1/job-postings\n```\n**Response:**\n```\n[PASTE_RESPONSE]\n```\n**Expected:** 403 Forbidden\n**Result:** [PASS/FAIL]\n\n**Test 1.2: Access public route**\n```bash\n$ curl -H \"Authorization: Bearer [USER_TOKEN]\" http://localhost:8102/api/v1/auth/me\n```\n**Response:**\n```\n[PASTE_RESPONSE]\n```\n**Expected:** 200 OK with user data\n**Result:** [PASS/FAIL]\n\n### Frontend Page Tests\n\n**Test 1.3: Try to access /job-postings**\n- URL: http://localhost:8103/job-postings\n- What I saw: [DESCRIBE]\n- Expected: Access denied page\n- Result: [PASS/FAIL]\n\n### Sidebar Menu Test\n\n**Test 1.4: Check visible menus**\n- Visible items: [LIST]\n- Expected: Only Dashboard\n- Result: [PASS/FAIL]\n\n---\n\n## Test 2: HR_SPECIALIST Role\n\n[Similar structure for HR_SPECIALIST]\n\n---\n\n## Test 3: MANAGER Role\n\n[Similar structure for MANAGER]\n\n---\n\n## Test 4: ADMIN Role\n\n[Similar structure for ADMIN]\n\n---\n\n## Test 5: SUPER_ADMIN Role\n\n[Similar structure for SUPER_ADMIN]\n\n---\n\n## Testing Matrix Summary\n\n| Role | Backend Routes | Frontend Pages | Sidebar Menus | Overall |\n|------|---------------|----------------|---------------|----------|\n| USER | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] |\n| HR_SPECIALIST | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] |\n| MANAGER | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] |\n| ADMIN | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] |\n| SUPER_ADMIN | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] | [PASS/FAIL] |\n\n**Total Tests:** 15 (5 roles √ó 3 test types)\n**Passed:** [COUNT]\n**Failed:** [COUNT]\n\n---\n\n## Issues Found\n\n[List any bugs/problems discovered]\n\n1. [Issue description]\n2. [Issue description]\n\nOr: **No issues found - All role checks working correctly** ‚úÖ\n"
    },
    {
      "id": "5.3",
      "title": "Performance & Load Testing",
      "priority": "MEDIUM",
      "estimatedTime": "20 minutes",
      "description": "Test authorize middleware performance and check for N+1 queries",
      "outputFile": "docs/reports/phase5-performance-testing.md",
      "instructions": [
        "1. Run backend with logging enabled",
        "2. Make 100 concurrent requests to protected route",
        "3. Check response times - docker logs ikai-backend",
        "4. Check for N+1 database queries",
        "5. Paste real log outputs to MD file",
        "‚ùå FORBIDDEN: Simulating performance tests",
        "‚úÖ REQUIRED: Real curl commands, real docker logs"
      ],
      "verificationCommands": {
        "load_test": "for i in {1..100}; do curl -s -H 'Authorization: Bearer TOKEN' http://localhost:8102/api/v1/job-postings & done; wait",
        "response_times": "docker logs ikai-backend --since 1m | grep 'GET /api/v1' | tail -20"
      }
    },
    {
      "id": "5.4",
      "title": "Security Audit Report",
      "priority": "HIGH",
      "estimatedTime": "30 minutes",
      "description": "Document security measures and verify no authorization bypasses",
      "outputFile": "docs/reports/phase5-security-audit.md",
      "instructions": [
        "1. Verify JWT validation in authorize middleware",
        "2. Check role hierarchy enforcement",
        "3. Test for authorization bypass attempts",
        "4. Document all security measures",
        "5. Use Read tool to check actual code",
        "‚ùå FORBIDDEN: Assuming code is secure without reading",
        "‚úÖ REQUIRED: Read actual middleware code, paste snippets"
      ],
      "securityChecks": [
        "JWT token validation",
        "Role hierarchy enforcement",
        "organizationId isolation",
        "No direct role string comparison vulnerabilities",
        "HOC properly wraps components",
        "Sidebar hooks check user.role correctly"
      ]
    },
    {
      "id": "5.5",
      "title": "Console & Log Final Verification",
      "priority": "CRITICAL",
      "estimatedTime": "15 minutes",
      "description": "Final check - ALL logs must be clean before marking RBAC complete",
      "outputFile": "docs/reports/phase5-cross-verification.md",
      "instructions": [
        "‚ö†Ô∏è ASANMOD STRICT MODE - LOG VERIFICATION REQUIRED ‚ö†Ô∏è",
        "1. Check frontend logs - docker logs ikai-frontend --tail 100 | grep -i 'error\\|warning\\|failed'",
        "2. Check backend logs - docker logs ikai-backend --tail 200 | grep -i 'error\\|exception\\|failed'",
        "3. Check all services health - docker ps --filter 'name=ikai'",
        "4. Test backend health - curl http://localhost:8102/health",
        "5. Paste ALL outputs (append to phase5-cross-verification.md)",
        "6. If ANY errors found - FIX FIRST before marking complete",
        "‚ùå FORBIDDEN: Marking RBAC complete with console errors",
        "‚úÖ REQUIRED: Clean logs across all services"
      ],
      "logVerificationTemplate": "\n\n---\n\n## Final Console & Log Verification\n\n### Frontend Logs (Last 100 lines)\n\n```bash\n$ docker logs ikai-frontend --tail 100 | grep -i \"error\\|warning\\|failed\"\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n(if no output: \"(no errors - clean logs)\")\n```\n\n---\n\n### Backend Logs (Last 200 lines)\n\n```bash\n$ docker logs ikai-backend --tail 200 | grep -i \"error\\|exception\\|failed\"\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n(if no output: \"(no errors - clean logs)\")\n```\n\n---\n\n### All Services Health\n\n```bash\n$ docker ps --filter \"name=ikai\" --format \"{{.Names}}: {{.Status}}\"\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** All services Up and healthy\n\n---\n\n### Backend Health Endpoint\n\n```bash\n$ curl -s http://localhost:8102/health | jq\n```\n\n**Output:**\n```\n[PASTE_EXACT_OUTPUT_HERE]\n```\n\n**Expected:** status: \"ok\", all services connected\n\n---\n\n### Final Verdict\n\n**Frontend Logs:** [CLEAN / ERRORS_FOUND]\n**Backend Logs:** [CLEAN / ERRORS_FOUND]\n**Services Health:** [ALL_HEALTHY / SOME_DOWN]\n**Backend API:** [HEALTHY / UNHEALTHY]\n\n**Overall Status:** [‚úÖ ALL_SYSTEMS_CLEAN / ‚ùå ERRORS_MUST_FIX]\n\n**If all clean:** ‚úÖ RBAC Implementation Ready for Production\n**If errors found:** ‚ùå Fix errors before marking complete\n",
      "verificationCommands": {
        "frontend_logs": "docker logs ikai-frontend --tail 100 | grep -i 'error\\|warning\\|failed'",
        "backend_logs": "docker logs ikai-backend --tail 200 | grep -i 'error\\|exception\\|failed'",
        "services_health": "docker ps --filter 'name=ikai' --format '{{.Names}}: {{.Status}}'",
        "backend_health": "curl -s http://localhost:8102/health | jq"
      }
    },
    {
      "id": "5.6",
      "title": "Final Documentation & README",
      "priority": "HIGH",
      "estimatedTime": "30 minutes",
      "description": "Create comprehensive RBAC documentation for developers",
      "outputFile": "docs/features/RBAC-IMPLEMENTATION-GUIDE.md",
      "instructions": [
        "1. Read all phase JSONs and verification reports",
        "2. Create developer guide with code examples",
        "3. Document role hierarchy, groups, usage patterns",
        "4. Include troubleshooting section",
        "5. Add quick reference for common tasks",
        "‚ùå FORBIDDEN: Generic documentation without real examples",
        "‚úÖ REQUIRED: Real code snippets from actual implementation"
      ],
      "documentationSections": [
        "Overview (what was implemented)",
        "Role Hierarchy (5 roles with permissions)",
        "Backend Usage (authorize middleware examples)",
        "Frontend Usage (withRoleProtection HOC examples)",
        "Sidebar Usage (useHasRole hook examples)",
        "Testing Guide (how to test each role)",
        "Troubleshooting (common issues & fixes)",
        "Phase Summary (P1-P5 what was done)",
        "AsanMod Verification (how Mod verified everything)"
      ]
    }
  ],

  "verification": {
    "allPhases": [
      "‚úÖ P1: authorize.js + withRoleProtection.tsx exist",
      "‚úÖ P2: 26 backend routes protected",
      "‚úÖ P3: 16 frontend pages protected",
      "‚úÖ P4: Sidebar menus role-filtered",
      "‚úÖ P5: E2E tests passed, logs clean"
    ],
    "finalChecks": [
      "‚úÖ All 5 roles tested (USER, HR_SPECIALIST, MANAGER, ADMIN, SUPER_ADMIN)",
      "‚úÖ Backend authorize middleware working",
      "‚úÖ Frontend withRoleProtection HOC working",
      "‚úÖ Sidebar useHasRole hooks working",
      "‚úÖ No console errors in frontend/backend",
      "‚úÖ All services healthy",
      "‚úÖ Documentation complete"
    ]
  },

  "completionCriteria": {
    "code": "All phases (P1-P5) verified with real data",
    "logs": "Frontend + Backend logs 100% clean",
    "tests": "E2E tests passed for all 5 roles",
    "security": "No authorization bypass vulnerabilities",
    "docs": "RBAC guide created with real examples",
    "modVerification": "Mod cross-checked all Worker outputs"
  },

  "completionMessage": "üéâ Phase 5 - RBAC Implementation COMPLETE!\n\n‚úÖ P1: Infrastructure (authorize.js + withRoleProtection.tsx)\n‚úÖ P2: 26 Backend Routes Protected\n‚úÖ P3: 16 Frontend Pages Protected  \n‚úÖ P4: Sidebar Navigation Role-Filtered\n‚úÖ P5: E2E Tests Passed + Documentation Complete\n\nüîí 5 Roles Implemented:\n- USER (Dashboard only)\n- HR_SPECIALIST (HR operations)\n- MANAGER (+ Analytics, Templates)\n- ADMIN (+ Team, Settings)\n- SUPER_ADMIN (Everything)\n\nüìä Total Protection:\n- Backend: 26 routes\n- Frontend: 16 pages\n- Sidebar: Role-based menu visibility\n\n‚úÖ AsanMod Verified: All phases cross-checked by Mod\n‚úÖ Logs Clean: No errors in frontend/backend\n‚úÖ Production Ready: RBAC fully functional\n\nüéØ IKAI HR Platform RBAC = COMPLETE",

  "nextSteps": "RBAC implementation complete. Next features can be built on top of this solid role-based access foundation."
}
